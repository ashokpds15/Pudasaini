name: MeroShare IPO Automation

on:
  # Run daily at 9:00 AM Nepal Time (UTC+5:45) = 3:15 AM UTC
  schedule:
    - cron: '15 3 * * *'  # 9:00 AM NPT (Nepal Time)
  
  # Allow manual triggering for testing
  workflow_dispatch:
    inputs:
      mode:
        description: 'Run mode'
        required: false
        default: 'multi'
        type: choice
        options:
          - single
          - multi

jobs:
  automate:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Install Playwright browsers
        run: npx playwright install --with-deps chromium
      
      - name: Run MeroShare automation (Multi-User)
        if: ${{ github.event.inputs.mode != 'single' }}
        env:
          # USER 1
MEROSHARE_USERNAME_1=your_username
MEROSHARE_PASSWORD_1=your_password
MEROSHARE_DP_NP_1=your_depository_participant
MEROSHARE_BANK_1=your_bank_name
MEROSHARE_P_ACCOUNT_NO_1=your_account_number
MEROSHARE_KITTA_N0_1=10
MEROSHARE_CRN_NO_1=your_crn_number
MEROSHARE_TXN_PIN_1=your_4_digit_pin

# USER 2
MEROSHARE_USERNAME_2=your_username
MEROSHARE_PASSWORD_2=your_password
MEROSHARE_DP_NP_2=your_depository_participant
MEROSHARE_BANK_2=your_bank_name
MEROSHARE_P_ACCOUNT_NO_2=your_account_number
MEROSHARE_KITTA_N0_2=10
MEROSHARE_CRN_NO_2=your_crn_number
MEROSHARE_TXN_PIN_2=your_4_digit_pin

# USER 3
MEROSHARE_USERNAME_3=your_username
MEROSHARE_PASSWORD_3=your_password
MEROSHARE_DP_NP_3=your_depository_participant
MEROSHARE_BANK_3=your_bank_name
MEROSHARE_P_ACCOUNT_NO_3=your_account_number
MEROSHARE_KITTA_N0_3=10
MEROSHARE_CRN_NO_3=your_crn_number
MEROSHARE_TXN_PIN_3=your_4_digit_pin

# USER 4
MEROSHARE_USERNAME_4=your_username
MEROSHARE_PASSWORD_4=your_password
MEROSHARE_DP_NP_4=your_depository_participant
MEROSHARE_BANK_4=your_bank_name
MEROSHARE_P_ACCOUNT_NO_4=your_account_number
MEROSHARE_KITTA_N0_4=10
MEROSHARE_CRN_NO_4=your_crn_number
MEROSHARE_TXN_PIN_4=your_4_digit_pin

# USER 5
MEROSHARE_USERNAME_5=your_username
MEROSHARE_PASSWORD_5=your_password
MEROSHARE_DP_NP_5=your_depository_participant
MEROSHARE_BANK_5=your_bank_name
MEROSHARE_P_ACCOUNT_NO_5=your_account_number
MEROSHARE_KITTA_N0_5=10
MEROSHARE_CRN_NO_5=your_crn_number
MEROSHARE_TXN_PIN_5=your_4_digit_pin

# USER 6
MEROSHARE_USERNAME_6=your_username
MEROSHARE_PASSWORD_6=your_password
MEROSHARE_DP_NP_6=your_depository_participant
MEROSHARE_BANK_6=your_bank_name
MEROSHARE_P_ACCOUNT_NO_6=your_account_number
MEROSHARE_KITTA_N0_6=10
MEROSHARE_CRN_NO_6=your_crn_number
MEROSHARE_TXN_PIN_6=your_4_digit_pin

# USER 7
MEROSHARE_USERNAME_7=your_username
MEROSHARE_PASSWORD_7=your_password
MEROSHARE_DP_NP_7=your_depository_participant
MEROSHARE_BANK_7=your_bank_name
MEROSHARE_P_ACCOUNT_NO_7=your_account_number
MEROSHARE_KITTA_N0_7=10
MEROSHARE_CRN_NO_7=your_crn_number
MEROSHARE_TXN_PIN_7=your_4_digit_pin

# USER 8
MEROSHARE_USERNAME_8=your_username
MEROSHARE_PASSWORD_8=your_password
MEROSHARE_DP_NP_8=your_depository_participant
MEROSHARE_BANK_8=your_bank_name
MEROSHARE_P_ACCOUNT_NO_8=your_account_number
MEROSHARE_KITTA_N0_8=10
MEROSHARE_CRN_NO_8=your_crn_number
MEROSHARE_TXN_PIN_8=your_4_digit_pin

# USER 9
MEROSHARE_USERNAME_9=your_username
MEROSHARE_PASSWORD_9=your_password
MEROSHARE_DP_NP_9=your_depository_participant
MEROSHARE_BANK_9=your_bank_name
MEROSHARE_P_ACCOUNT_NO_9=your_account_number
MEROSHARE_KITTA_N0_9=10
MEROSHARE_CRN_NO_9=your_crn_number
MEROSHARE_TXN_PIN_9=your_4_digit_pin

# USER 10
MEROSHARE_USERNAME_10=your_username
MEROSHARE_PASSWORD_10=your_password
MEROSHARE_DP_NP_10=your_depository_participant
MEROSHARE_BANK_10=your_bank_name
MEROSHARE_P_ACCOUNT_NO_10=your_account_number
MEROSHARE_KITTA_N0_10=10
MEROSHARE_CRN_NO_10=your_crn_number
MEROSHARE_TXN_PIN_10=your_4_digit_pin

          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: npm run automate:multi

      - name: Run MeroShare automation (Single User)
        if: ${{ github.event.inputs.mode == 'single' }}
        env:
          MEROSHARE_USERNAME: ${{ secrets.MEROSHARE_USERNAME }}
          MEROSHARE_PASSWORD: ${{ secrets.MEROSHARE_PASSWORD }}
          MEROSHARE_DP_NP: ${{ secrets.MEROSHARE_DP_NP }}
          MEROSHARE_BANK: ${{ secrets.MEROSHARE_BANK }}
          MEROSHARE_P_ACCOUNT_NO: ${{ secrets.MEROSHARE_P_ACCOUNT_NO }}
          MEROSHARE_KITTA_N0: ${{ secrets.MEROSHARE_KITTA_N0 }}
          MEROSHARE_CRN_NO: ${{ secrets.MEROSHARE_CRN_NO }}
          MEROSHARE_TXN_PIN: ${{ secrets.MEROSHARE_TXN_PIN }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: npm run automate

