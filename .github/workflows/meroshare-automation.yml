name: MeroShare IPO Automation

on:
  # Run daily at 9:00 AM Nepal Time (UTC+5:45) = 3:15 AM UTC
  schedule:
    - cron: '15 3 * * *'  # 9:00 AM NPT (Nepal Time)
  
  # Allow manual triggering for testing
  workflow_dispatch:
    inputs:
      mode:
        description: 'Run mode'
        required: false
        default: 'multi'
        type: choice
        options:
          - single
          - multi

jobs:
  automate:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Install Playwright browsers
        run: npx playwright install --with-deps chromium
      
      - name: Run MeroShare automation (Multi-User)
        if: ${{ github.event.inputs.mode != 'single' }}
        env:
          # USER 1
MEROSHARE_USERNAME_1: ${{ secrets.MEROSHARE_USERNAME_1 }}
MEROSHARE_PASSWORD_1: ${{ secrets.MEROSHARE_PASSWORD_1 }}
MEROSHARE_DP_NP_1: ${{ secrets.MEROSHARE_DP_NP_1 }}
MEROSHARE_BANK_1: ${{ secrets.MEROSHARE_BANK_1 }}
MEROSHARE_P_ACCOUNT_NO_1: ${{ secrets.MEROSHARE_P_ACCOUNT_NO_1 }}
MEROSHARE_KITTA_N0_1: ${{ secrets.MEROSHARE_KITTA_N0_1 }}
MEROSHARE_CRN_NO_1: ${{ secrets.MEROSHARE_CRN_NO_1 }}
MEROSHARE_TXN_PIN_1: ${{ secrets.MEROSHARE_TXN_PIN_1 }}

# USER 2
MEROSHARE_USERNAME_2: ${{ secrets.MEROSHARE_USERNAME_2 }}
MEROSHARE_PASSWORD_2: ${{ secrets.MEROSHARE_PASSWORD_2 }}
MEROSHARE_DP_NP_2: ${{ secrets.MEROSHARE_DP_NP_2 }}
MEROSHARE_BANK_2: ${{ secrets.MEROSHARE_BANK_2 }}
MEROSHARE_P_ACCOUNT_NO_2: ${{ secrets.MEROSHARE_P_ACCOUNT_NO_2 }}
MEROSHARE_KITTA_N0_2: ${{ secrets.MEROSHARE_KITTA_N0_2 }}
MEROSHARE_CRN_NO_2: ${{ secrets.MEROSHARE_CRN_NO_2 }}
MEROSHARE_TXN_PIN_2: ${{ secrets.MEROSHARE_TXN_PIN_2 }}

# USER 3
MEROSHARE_USERNAME_3: ${{ secrets.MEROSHARE_USERNAME_3 }}
MEROSHARE_PASSWORD_3: ${{ secrets.MEROSHARE_PASSWORD_3 }}
MEROSHARE_DP_NP_3: ${{ secrets.MEROSHARE_DP_NP_3 }}
MEROSHARE_BANK_3: ${{ secrets.MEROSHARE_BANK_3 }}
MEROSHARE_P_ACCOUNT_NO_3: ${{ secrets.MEROSHARE_P_ACCOUNT_NO_3 }}
MEROSHARE_KITTA_N0_3: ${{ secrets.MEROSHARE_KITTA_N0_3 }}
MEROSHARE_CRN_NO_3: ${{ secrets.MEROSHARE_CRN_NO_3 }}
MEROSHARE_TXN_PIN_3: ${{ secrets.MEROSHARE_TXN_PIN_3 }}

# USER 4
MEROSHARE_USERNAME_4: ${{ secrets.MEROSHARE_USERNAME_4 }}
MEROSHARE_PASSWORD_4: ${{ secrets.MEROSHARE_PASSWORD_4 }}
MEROSHARE_DP_NP_4: ${{ secrets.MEROSHARE_DP_NP_4 }}
MEROSHARE_BANK_4: ${{ secrets.MEROSHARE_BANK_4 }}
MEROSHARE_P_ACCOUNT_NO_4: ${{ secrets.MEROSHARE_P_ACCOUNT_NO_4 }}
MEROSHARE_KITTA_N0_4: ${{ secrets.MEROSHARE_KITTA_N0_4 }}
MEROSHARE_CRN_NO_4: ${{ secrets.MEROSHARE_CRN_NO_4 }}
MEROSHARE_TXN_PIN_4: ${{ secrets.MEROSHARE_TXN_PIN_4 }}

# USER 5
MEROSHARE_USERNAME_5: ${{ secrets.MEROSHARE_USERNAME_5 }}
MEROSHARE_PASSWORD_5: ${{ secrets.MEROSHARE_PASSWORD_5 }}
MEROSHARE_DP_NP_5: ${{ secrets.MEROSHARE_DP_NP_5 }}
MEROSHARE_BANK_5: ${{ secrets.MEROSHARE_BANK_5 }}
MEROSHARE_P_ACCOUNT_NO_5: ${{ secrets.MEROSHARE_P_ACCOUNT_NO_5 }}
MEROSHARE_KITTA_N0_5: ${{ secrets.MEROSHARE_KITTA_N0_5 }}
MEROSHARE_CRN_NO_5: ${{ secrets.MEROSHARE_CRN_NO_5 }}
MEROSHARE_TXN_PIN_5: ${{ secrets.MEROSHARE_TXN_PIN_5 }}

# USER 6
MEROSHARE_USERNAME_6: ${{ secrets.MEROSHARE_USERNAME_6 }}
MEROSHARE_PASSWORD_6: ${{ secrets.MEROSHARE_PASSWORD_6 }}
MEROSHARE_DP_NP_6: ${{ secrets.MEROSHARE_DP_NP_6 }}
MEROSHARE_BANK_6: ${{ secrets.MEROSHARE_BANK_6 }}
MEROSHARE_P_ACCOUNT_NO_6: ${{ secrets.MEROSHARE_P_ACCOUNT_NO_6 }}
MEROSHARE_KITTA_N0_6: ${{ secrets.MEROSHARE_KITTA_N0_6 }}
MEROSHARE_CRN_NO_6: ${{ secrets.MEROSHARE_CRN_NO_6 }}
MEROSHARE_TXN_PIN_6: ${{ secrets.MEROSHARE_TXN_PIN_6 }}

# USER 7
MEROSHARE_USERNAME_7: ${{ secrets.MEROSHARE_USERNAME_7 }}
MEROSHARE_PASSWORD_7: ${{ secrets.MEROSHARE_PASSWORD_7 }}
MEROSHARE_DP_NP_7: ${{ secrets.MEROSHARE_DP_NP_7 }}
MEROSHARE_BANK_7: ${{ secrets.MEROSHARE_BANK_7 }}
MEROSHARE_P_ACCOUNT_NO_7: ${{ secrets.MEROSHARE_P_ACCOUNT_NO_7 }}
MEROSHARE_KITTA_N0_7: ${{ secrets.MEROSHARE_KITTA_N0_7 }}
MEROSHARE_CRN_NO_7: ${{ secrets.MEROSHARE_CRN_NO_7 }}
MEROSHARE_TXN_PIN_7: ${{ secrets.MEROSHARE_TXN_PIN_7 }}

# USER 8
MEROSHARE_USERNAME_8: ${{ secrets.MEROSHARE_USERNAME_8 }}
MEROSHARE_PASSWORD_8: ${{ secrets.MEROSHARE_PASSWORD_8 }}
MEROSHARE_DP_NP_8: ${{ secrets.MEROSHARE_DP_NP_8 }}
MEROSHARE_BANK_8: ${{ secrets.MEROSHARE_BANK_8 }}
MEROSHARE_P_ACCOUNT_NO_8: ${{ secrets.MEROSHARE_P_ACCOUNT_NO_8 }}
MEROSHARE_KITTA_N0_8: ${{ secrets.MEROSHARE_KITTA_N0_8 }}
MEROSHARE_CRN_NO_8: ${{ secrets.MEROSHARE_CRN_NO_8 }}
MEROSHARE_TXN_PIN_8: ${{ secrets.MEROSHARE_TXN_PIN_8 }}

# USER 9
MEROSHARE_USERNAME_9: ${{ secrets.MEROSHARE_USERNAME_9 }}
MEROSHARE_PASSWORD_9: ${{ secrets.MEROSHARE_PASSWORD_9 }}
MEROSHARE_DP_NP_9: ${{ secrets.MEROSHARE_DP_NP_9 }}
MEROSHARE_BANK_9: ${{ secrets.MEROSHARE_BANK_9 }}
MEROSHARE_P_ACCOUNT_NO_9: ${{ secrets.MEROSHARE_P_ACCOUNT_NO_9 }}
MEROSHARE_KITTA_N0_9: ${{ secrets.MEROSHARE_KITTA_N0_9 }}
MEROSHARE_CRN_NO_9: ${{ secrets.MEROSHARE_CRN_NO_9 }}
MEROSHARE_TXN_PIN_9: ${{ secrets.MEROSHARE_TXN_PIN_9 }}

# USER 10
MEROSHARE_USERNAME_10: ${{ secrets.MEROSHARE_USERNAME_10 }}
MEROSHARE_PASSWORD_10: ${{ secrets.MEROSHARE_PASSWORD_10 }}
MEROSHARE_DP_NP_10: ${{ secrets.MEROSHARE_DP_NP_10 }}
MEROSHARE_BANK_10: ${{ secrets.MEROSHARE_BANK_10 }}
MEROSHARE_P_ACCOUNT_NO_10: ${{ secrets.MEROSHARE_P_ACCOUNT_NO_10 }}
MEROSHARE_KITTA_N0_10: ${{ secrets.MEROSHARE_KITTA_N0_10 }}
MEROSHARE_CRN_NO_10: ${{ secrets.MEROSHARE_CRN_NO_10 }}
MEROSHARE_TXN_PIN_10: ${{ secrets.MEROSHARE_TXN_PIN_10 }}
#teligram 
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: npm run automate:multi

      - name: Run MeroShare automation (Single User)
        if: ${{ github.event.inputs.mode == 'single' }}
        env:
          MEROSHARE_USERNAME: ${{ secrets.MEROSHARE_USERNAME }}
          MEROSHARE_PASSWORD: ${{ secrets.MEROSHARE_PASSWORD }}
          MEROSHARE_DP_NP: ${{ secrets.MEROSHARE_DP_NP }}
          MEROSHARE_BANK: ${{ secrets.MEROSHARE_BANK }}
          MEROSHARE_P_ACCOUNT_NO: ${{ secrets.MEROSHARE_P_ACCOUNT_NO }}
          MEROSHARE_KITTA_N0: ${{ secrets.MEROSHARE_KITTA_N0 }}
          MEROSHARE_CRN_NO: ${{ secrets.MEROSHARE_CRN_NO }}
          MEROSHARE_TXN_PIN: ${{ secrets.MEROSHARE_TXN_PIN }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: npm run automate

